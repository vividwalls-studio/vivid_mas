{%- comment -%}
  VividWalls Product Page Template - Fixed to Match Figma Exactly
  Clean structure with separated CSS and JavaScript
{%- endcomment -%}

{{ 'vividwalls-product-fixed.css' | asset_url | stylesheet_tag }}

<script>
  window.vividwallsProductHandle = "{{ product.handle }}";
</script>

<div class="vividwalls-product-section page-width">
  <div class="vividwalls-main-container">
    
    <!-- Section 01 - Main Product Display -->
    <div class="vividwalls-section-01">
      
      <!-- Artwork Container -->
      <div class="vividwalls-artwork-container">
        
        <!-- Main Artwork Image -->
        <div class="vividwalls-main-image">
          <div class="vividwalls-image-wrapper">
            {% if product.featured_media %}
              {{ product.featured_media | image_url: width: 800 | image_tag: 
                 alt: product.featured_media.alt | default: product.title,
                 class: 'vividwalls-main-img' }}
            {% endif %}
          </div>
        </div>
        
        <!-- Thumbnails Container -->
        <div class="vividwalls-thumbnails-container">
          
          <div class="vividwalls-thumbnails">
            {% comment %} Show thumbnails for Canvas Roll variants only {% endcomment %}
            {% assign canvas_variants = product.variants | where: 'title', 'Canvas Roll' %}
            {% assign sorted_sizes = '24x36,36x48,53x72' | split: ',' %}
            {% assign thumbnail_index = 0 %}
            
            {% for size in sorted_sizes %}
              {% for variant in canvas_variants %}
                {% if variant.title contains 'Canvas Roll' and variant.featured_media %}
                  {% assign variant_size = variant.title | remove: 'Canvas Roll / ' | strip %}
                  {% if variant_size == size %}
                    {% assign thumbnail_index = thumbnail_index | plus: 1 %}
                    <div class="vividwalls-thumbnail-item" data-variant-id="{{ variant.id }}" data-variant-size="{{ variant_size }}">
                      <div class="vividwalls-thumbnail-wrapper">
                        {% if size == '24x36' %}
                          <div class="vividwalls-selected-indicator"></div>
                        {% endif %}
                        {{ variant.featured_media | image_url: width: 224, height: 288 | image_tag: 
                           alt: variant.featured_media.alt | default: variant.title,
                           class: 'vividwalls-thumbnail',
                           data-variant-id: variant.id }}
                      </div>
                    </div>
                  {% endif %}
                {% endif %}
              {% endfor %}
            {% endfor %}
            
            {% comment %} If not enough variant images, fill with placeholder thumbnails {% endcomment %}
            {% if thumbnail_index < 4 %}
              {% for i in (1..4) %}
                {% if i > thumbnail_index %}
                  <div class="vividwalls-thumbnail-item">
                    <div class="vividwalls-thumbnail-wrapper">
                      {{ product.featured_media | image_url: width: 224, height: 288 | image_tag: 
                         alt: product.featured_media.alt | default: product.title,
                         class: 'vividwalls-thumbnail' }}
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
            {% endif %}
          </div>
          
          <!-- Social Share Container -->
          <div class="vividwalls-social-share">
            <div class="vividwalls-share-icon">
              <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.5589 19.2646C10.7604 19.4532 11.0772 19.4425 11.266 19.2412L17.266 12.8417C17.4459 12.6494 17.4462 12.3494 17.266 12.1572L11.266 5.75776L11.1888 5.69135C10.9992 5.55724 10.7352 5.56959 10.5589 5.73432C10.3827 5.89952 10.3523 6.16319 10.474 6.36127L10.5355 6.44135L16.2142 12.499L10.5355 18.5576C10.3469 18.759 10.3576 19.0758 10.5589 19.2646Z" fill="#262626"/>
              </svg>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Product Info -->
      <div class="vividwalls-product-info">
        
        <!-- Product Info Container -->
        <div class="vividwalls-info-container">
          
          <div class="vividwalls-product-header">
            <!-- Product Title -->
            <div class="vividwalls-product-name">{{ product.title }}</div>
            
            <!-- Collection & Artist Info -->
            <div class="vividwalls-collection-name">
              Collection â†’ {% if product.metafields.custom.collection_name %}{{ product.metafields.custom.collection_name }}{% else %}Vivid Layers{% endif %}
            </div>
            
            <div class="vividwalls-artist-info">
              <span class="vividwalls-artist-label">Original Art Illustrations by </span>
              <span class="vividwalls-artist-name">{% if product.metafields.custom.artist_name %}{{ product.metafields.custom.artist_name }}{% else %}Kingler Bercy{% endif %}</span>
            </div>
            
            <!-- Limited Edition Tag -->
            {% if product.tags contains 'limited-edition' %}
              <div class="vividwalls-tag-container">
                <div class="vividwalls-tag">Limited Edition Print</div>
              </div>
            {% endif %}
          </div>
        </div>
        
        <!-- Shopping Cart Component -->
        <form action="/cart/add" method="post" enctype="multipart/form-data" id="vividwalls-product-form">
          <div class="vividwalls-shopping-cart">
            
            <!-- Total Selected Price -->
            <div class="vividwalls-total-price-display">
              <div class="vividwalls-dimensions">
                <span class="vividwalls-width">24</span>
                <span class="vividwalls-separator">X</span>
                <span class="vividwalls-height">36</span>
              </div>
              <div class="vividwalls-total-price">
                {{ product.selected_or_first_available_variant.price | money }}
              </div>
            </div>
            
            <!-- Variant Picker -->
            <div class="vividwalls-variant-picker">
              <div class="vividwalls-variant-options">
                
                {% comment %} Filter to only show Canvas Roll variants in specific order {% endcomment %}
                {% assign canvas_variants = product.variants | where: 'title', 'Canvas Roll' %}
                {% assign sorted_sizes = '24x36,36x48,53x72' | split: ',' %}
                
                {% for size in sorted_sizes %}
                  {% for variant in canvas_variants %}
                    {% if variant.title contains 'Canvas Roll' %}
                      {% assign variant_size = variant.title | remove: 'Canvas Roll / ' | strip %}
                      {% if variant_size == size %}
                        {% assign size_parts = variant_size | split: 'x' %}
                        {% assign width = size_parts[0] | strip %}
                        {% assign height = size_parts[1] | strip %}
                        {% assign is_selected = false %}
                        {% if size == '24x36' %}
                          {% assign is_selected = true %}
                        {% endif %}
                        
                        <div class="vividwalls-variant-option{% if is_selected %} selected{% endif %}" 
                             data-variant-id="{{ variant.id }}"
                             data-variant-price="{{ variant.price }}"
                             data-variant-size="{{ width }}x{{ height }}"
                             data-variant-available="{{ variant.available }}"
                             data-variant-inventory="{{ variant.inventory_quantity }}"
                             {% if variant.featured_media %}
                             data-variant-image="{{ variant.featured_media | image_url: width: 800 }}"
                             {% endif %}
                             {% comment %} Find gallery wrap price for this size {% endcomment %}
                             {% for gw_variant in gallery_wrap_variants %}
                               {% assign gw_size = gw_variant.title | remove: 'Gallery Wrapped Canvas / ' | strip %}
                               {% if gw_size == size %}
                                 data-gallery-wrap-price="{{ gw_variant.price | minus: variant.price | divided_by: 100.0 }}"
                               {% endif %}
                             {% endfor %}>
                          
                          <div class="vividwalls-variant-info">
                            <div class="vividwalls-variant-dimensions">
                              <span class="vividwalls-variant-width">{{ width }}</span>
                              <span class="vividwalls-variant-separator">X</span>
                              <span class="vividwalls-variant-height">{{ height }}</span>
                            </div>
                            <div class="vividwalls-variant-price">{{ variant.price | money }}</div>
                          </div>
                          
                          <div class="vividwalls-variant-stock">
                            <!-- Chevron Icon for Selected Variant -->
                            <div class="vividwalls-chevron-icon">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18.1377 14.0263C18.3358 14.1482 18.5994 14.1177 18.7646 13.9414C18.9296 13.7652 18.9425 13.5012 18.8086 13.3115L18.7412 13.2343L12.3418 7.23434C12.1735 7.07701 11.9229 7.05752 11.7344 7.17575L11.6572 7.23434L5.2578 13.2343L5.1914 13.3115C5.05731 13.5011 5.06978 13.7651 5.23437 13.9414C5.39958 14.1176 5.66323 14.148 5.86132 14.0263L5.9414 13.9648L11.999 8.2861L18.0576 13.9648L18.1377 14.0263Z" fill="#E5E5E5"/>
                              </svg>
                            </div>
                            
                            <div class="vividwalls-stock-info">
                              {% if variant.inventory_management %}
                                {% assign sold_count = 0 %}
                                {% if width == '24' and height == '36' %}
                                  {% assign sold_count = 50 %}
                                {% elsif width == '36' and height == '48' %}
                                  {% assign sold_count = 150 %}
                                {% elsif width == '53' and height == '72' %}
                                  {% assign sold_count = 50 %}
                                {% endif %}
                                {{ sold_count }} sold - {{ variant.inventory_quantity }} remaining
                              {% else %}
                                In stock
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      {% endif %}
                    {% endif %}
                  {% endfor %}
                {% endfor %}
              </div>
            </div>
            
            <!-- Canvas Finish Options -->
            <div class="vividwalls-gallery-wrap-container">
              <div class="vividwalls-gallery-wrap-option">
                <label class="vividwalls-gallery-wrap-checkbox">
                  <div class="vividwalls-checkbox-visual">
                    <div class="vividwalls-check-icon">
                      <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10.601 3.90789C10.7897 3.61921 11.1774 3.53791 11.4662 3.72625C11.755 3.91508 11.8365 4.30261 11.6479 4.59148L7.39786 11.0915C7.29769 11.2446 7.13503 11.3466 6.95352 11.3698C6.77212 11.3928 6.58883 11.3356 6.45352 11.2126L3.70352 8.71257L3.61954 8.61785C3.44827 8.38321 3.45857 8.05217 3.66153 7.82878C3.8645 7.60556 4.19295 7.56367 4.44278 7.7116L4.54532 7.78679L6.75235 9.79265L10.601 3.90789Z" fill="white"/>
                      </svg>
                    </div>
                  </div>
                  <input type="checkbox" name="properties[Gallery Wrap]" value="yes" id="gallery-wrap-checkbox">
                  <div class="vividwalls-gallery-wrap-label">Gallery Wrapped Stretched Canvas</div>
                </label>
                
                <div class="vividwalls-gallery-wrap-prices">
                  {% comment %} Dynamic gallery wrap prices from variant metafields {% endcomment %}
                  {% assign gallery_wrap_variants = product.variants | where: 'title', 'Gallery Wrapped Canvas' %}
                  {% assign sorted_sizes = '24x36,36x48,53x72' | split: ',' %}
                  {% assign price_index = 0 %}
                  
                  {% for size in sorted_sizes %}
                    {% for variant in gallery_wrap_variants %}
                      {% if variant.title contains 'Gallery Wrapped Canvas' %}
                        {% assign variant_size = variant.title | remove: 'Gallery Wrapped Canvas / ' | strip | downcase %}
                        {% if variant_size == size %}
                          {% comment %} Find matching Canvas Roll variant to calculate difference {% endcomment %}
                          {% for canvas_variant in canvas_variants %}
                            {% assign canvas_size = canvas_variant.title | remove: 'Canvas Roll / ' | strip | downcase %}
                            {% if canvas_size == size %}
                              {% assign price_diff = variant.price | minus: canvas_variant.price %}
                              {% if price_index > 0 %}
                                <div class="vividwalls-price-separator"></div>
                              {% endif %}
                              <span>{{ size | upcase }} + {{ price_diff | money | remove: '.00' }}</span>
                              {% assign price_index = price_index | plus: 1 %}
                              {% break %}
                            {% endif %}
                          {% endfor %}
                          {% break %}
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  {% endfor %}
                  
                  {% comment %} Fallback if no gallery wrap variants found {% endcomment %}
                  {% if price_index == 0 %}
                    <span>24X36 + $75</span>
                    <div class="vividwalls-price-separator"></div>
                    <span>36X48 + $75</span>
                    <div class="vividwalls-price-separator"></div>
                    <span>53X72 + $125</span>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <!-- Buy Button Section -->
            <div class="vividwalls-buy-section">
              
              <div class="vividwalls-sku">SKU: {{ product.selected_or_first_available_variant.sku | default: 'N/A' }}</div>
              
              <div class="vividwalls-quantity-and-buy">
                
                <!-- Quantity Selector -->
                <div class="vividwalls-quantity-selector">
                  <button type="button" class="vividwalls-quantity-button vividwalls-quantity-minus">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19.7012 11.5098C19.9289 11.5565 20.1006 11.7585 20.1006 12C20.1006 12.2415 19.9289 12.4435 19.7012 12.4902L19.6006 12.5H4.40039C4.12425 12.5 3.90039 12.2761 3.90039 12C3.90039 11.7239 4.12425 11.5 4.40039 11.5H19.6006L19.7012 11.5098Z" fill="#262626"/>
                    </svg>
                  </button>
                  
                  <div class="vividwalls-quantity-value">
                    <input type="number" name="quantity" value="1" min="1" class="vividwalls-quantity-input">
                  </div>
                  
                  <button type="button" class="vividwalls-quantity-button vividwalls-quantity-plus">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 3.90039C12.2761 3.90039 12.5 4.12425 12.5 4.40039V11.5H19.6006L19.7012 11.5098C19.9289 11.5565 20.1006 11.7585 20.1006 12C20.1006 12.2415 19.9289 12.4435 19.7012 12.4902L19.6006 12.5H12.5V19.6006C12.4997 19.8765 12.2759 20.1006 12 20.1006C11.7241 20.1006 11.5003 19.8765 11.5 19.6006V12.5H4.40039C4.12425 12.5 3.90039 12.2761 3.90039 12C3.90039 11.7239 4.12425 11.5 4.40039 11.5H11.5V4.40039C11.5 4.12425 11.7239 3.90039 12 3.90039Z" fill="#262626"/>
                    </svg>
                  </button>
                </div>
                
                <!-- Add to Cart Button -->
                <button type="submit" name="add" class="vividwalls-add-to-cart">
                  <span>ADD TO CART</span>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Hidden Form Fields -->
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          <input type="hidden" name="properties[_gallery_wrap_price]" value="0">
        </form>
        
        <!-- Purchase Options -->
        <div class="vividwalls-purchase-options">
          
          <!-- Shop Pay Button -->
          <button class="vividwalls-shop-pay-button">Buy with Shop Pay</button>
          
          <!-- Shipping Info -->
          <div class="vividwalls-shipping-info">
            <div class="vividwalls-shipping-label">
              <span class="underline">Shipping</span>
              <span class="regular"> calculated at checkout.</span>
            </div>
            
            <div class="vividwalls-installment-info">
              <div class="vividwalls-installment-text">
                4 interest-free installments, or from 
                <span class="vividwalls-installment-price">$100.00</span>/mo with Shop Pay
              </div>
            </div>
            
            <div class="vividwalls-power-info">
              <div class="vividwalls-power-text">Check your purchasing power</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Section 02 - Description & Additional Image -->
    <div class="vividwalls-section-02">
      <div class="vividwalls-section-02-content">
        
        <!-- Description -->
        <div class="vividwalls-description-container">
          <div class="vividwalls-description-wrapper">
            <div class="vividwalls-description-text">
              {% if product.description != blank %}
                {{ product.description | strip_html }}
              {% else %}
                Experience the subtle elegance of this sophisticated abstract composition that brings nature-inspired tones to modern interiors. This limited edition print features an intricate interplay of colors and textures, creating a calming yet dynamic visual that complements any space.
              {% endif %}
            </div>
          </div>
        </div>
        
        <!-- Additional Artwork Image -->
        <div class="vividwalls-additional-image">
          <div class="vividwalls-additional-image-wrapper">
            {% if product.media[1] %}
              {{ product.media[1] | image_url: width: 828 | image_tag: 
                 alt: product.media[1].alt | default: product.title }}
            {% elsif product.featured_media %}
              {{ product.featured_media | image_url: width: 828 | image_tag: 
                 alt: product.featured_media.alt | default: product.title }}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{{ 'vividwalls-product-final.js' | asset_url }}" defer></script>